<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowWork - AI Research & Collaboration Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Neutral tone design */
        :root {
            --primary: #6b7280;
            --secondary: #374151;
            --accent: #4f46e5;
            --light: #f8fafc;
            --border: #e5e7eb;
        }
        
        body {
            background: linear-gradient(to br, #f9fafb, #f3f4f6);
        }
        
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(75, 85, 99, 0.1);
            border-color: var(--primary);
        }
        
        .sidebar-section {
            border: 1px solid var(--border);
            border-radius: 12px;
            background: white;
            margin-bottom: 1rem;
        }
        
        .nav-item-active {
            background-color: #f1f5f9;
            color: var(--accent);
            border-left: 3px solid var(--accent);
        }
        
        .card-hover:hover {
            border-color: var(--primary);
            background-color: #f8fafc;
        }
        
        .btn-outline {
            border: 1px solid var(--border);
            background: transparent;
            transition: all 0.2s ease;
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            background-color: var(--light);
        }
        
        .meeting-status {
            position: relative;
            overflow: hidden;
        }
        
        .meeting-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .ai-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Top Bar -->
    <header class="bg-white shadow-sm border-b h-16 fixed w-full top-0 z-50">
        <div class="flex items-center justify-between h-full px-4">
            <!-- Logo -->
            <div class="flex items-center space-x-4">
                <div class="text-2xl font-bold text-gray-700">
                    <i class="fas fa-rocket text-indigo-600"></i> FlowWork
                </div>
            </div>

            <!-- Right Section -->
            <div class="flex items-center space-x-4">
                <!-- Credits -->
                <div class="flex items-center space-x-2 bg-gray-100 px-3 py-1 rounded-lg">
                    <i class="fas fa-coins text-gray-600"></i>
                    <span class="text-gray-700 font-semibold">1,246</span>
                </div>

                <!-- Team Selector -->
                <div class="relative">
                    <button class="flex items-center space-x-2 px-3 py-2 hover:bg-gray-100 rounded-lg" onclick="toggleTeamDropdown()">
                        <i class="fas fa-users text-gray-600"></i>
                        <span class="hidden md:block">ทีมการตลาด</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                </div>

                <!-- Notifications -->
                <div class="relative">
                    <button class="p-2 hover:bg-gray-100 rounded-lg relative">
                        <i class="fas fa-bell text-gray-600"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">1</span>
                    </button>
                </div>

                <!-- User Menu -->
                <div class="relative">
                    <button class="flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg">
                        <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center text-white font-semibold">
                            <i class="fas fa-user"></i>
                        </div>
                        <i class="fas fa-chevron-down text-xs hidden md:block"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex pt-16 h-screen">
        
        <!-- Left Sidebar -->
        <aside class="w-80 bg-white shadow-sm border-r overflow-y-auto">
            <div class="p-4">
                
                <!-- Search Section (Moved to Top) -->
                <div class="sidebar-section p-4 mb-4">
                    <div class="relative">
                        <input type="text" 
                               placeholder="ค้นหาทั่วไป..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none search-input">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- User Type Badge -->
                <div class="bg-gray-600 text-white px-4 py-2 rounded-lg mb-6">
                    <div class="flex items-center justify-between">
                        <span class="font-semibold">ข้าราชการ</span>
                        <button onclick="changeUserType()" class="text-xs opacity-75 hover:opacity-100">
                            <i class="fas fa-sync-alt"></i> เปลี่ยน
                        </button>
                    </div>
                    <div class="text-xs opacity-75 mt-1">Government Official</div>
                </div>

                <!-- Navigation Menu (Sectioned) -->
                <nav class="space-y-2">
                    <!-- AI Research Section -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 nav-item-active rounded-lg cursor-pointer" onclick="showResearch()">
                            <i class="fas fa-search"></i>
                            <span class="font-medium">AI Research</span>
                        </div>
                        <div class="ml-6 mt-2 space-y-1">
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-plus-circle w-4"></i> New Research
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-history w-4"></i> Recent Searches
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-star w-4"></i> Saved Queries
                            </a>
                            <!-- New: Meeting Knowledge Search -->
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600" onclick="showMeetingKnowledge()">
                                <i class="fas fa-brain w-4"></i> Meeting Knowledge
                                <span class="ai-badge">AI</span>
                            </a>
                        </div>
                    </div>

                    <!-- Documents Section -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg cursor-pointer">
                            <i class="fas fa-file-alt"></i>
                            <span class="font-medium">Documents</span>
                        </div>
                    </div>

                    <!-- Team Workspace Section -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg cursor-pointer">
                            <i class="fas fa-users"></i>
                            <span class="font-medium">Team Workspace</span>
                            <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full ml-auto">8</span>
                        </div>
                    </div>

                    <!-- Meeting Intelligence Section (Enhanced with Nexus Features) -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg cursor-pointer" onclick="showMeetingAnalysis()">
                            <i class="fas fa-microphone"></i>
                            <span class="font-medium">Meeting Intelligence</span>
                            <span class="ai-badge">AI+</span>
                        </div>
                        <div class="ml-6 mt-2 space-y-1">
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600" onclick="startLiveRecording()">
                                <i class="fas fa-record-vinyl w-4 text-red-500"></i> Live Recording
                                <span class="ai-badge">New</span>
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600" onclick="showMeetingAnalysis()">
                                <i class="fas fa-upload w-4"></i> Upload Recording
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-list w-4"></i> Past Meetings
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600" onclick="showMeetingChat()">
                                <i class="fas fa-comments w-4"></i> Ask Meeting AI
                                <span class="ai-badge">Chat</span>
                            </a>
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-tasks w-4"></i> Action Items
                            </a>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg cursor-pointer">
                            <i class="fas fa-chart-bar"></i>
                            <span class="font-medium">Analytics</span>
                        </div>
                        <div class="ml-6 mt-2 space-y-1">
                            <!-- New: Meeting Analytics -->
                            <a href="#" class="block px-3 py-1 text-sm text-gray-600 hover:text-indigo-600">
                                <i class="fas fa-chart-line w-4"></i> Meeting Performance
                                <span class="ai-badge">New</span>
                            </a>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div class="sidebar-section p-3">
                        <div class="flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg cursor-pointer">
                            <i class="fas fa-cog"></i>
                            <span class="font-medium">Settings</span>
                        </div>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <div class="p-6">
                
                <!-- Research Section (Default) -->
                <div id="researchSection">
                    <!-- Page Header -->
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 mb-2">
                            <i class="fas fa-search-plus text-indigo-600"></i> Research Assistant for Government Officials
                        </h1>
                        <p class="text-gray-600">ค้นหาข้อมูลเชิงลึกจากแหล่งราชการและกฎหมายไทย</p>
                    </div>

                    <!-- Search Interface (Perplexity Style) -->
                    <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                        <div class="mb-4">
                            <div class="relative">
                                <textarea 
                                    id="mainSearch"
                                    placeholder="ค้นหาข้อมูลเชิงลึก เช่น 'ขั้นตอนการขอจดทะเบียนธุรกิจใหม่ตามกฎหมายไทย'"
                                    class="w-full h-24 p-4 border border-gray-300 rounded-lg resize-none focus:outline-none search-input"
                                    onkeydown="handleSearchKeydown(event)"></textarea>
                                
                                <div class="absolute bottom-3 right-3 flex space-x-2">
                                    <button class="p-2 text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="p-2 text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-paperclip"></i>
                                    </button>
                                    <button onclick="performSearch()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium">
                                        <i class="fas fa-paper-plane"></i> ส่ง
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Filters -->
                        <div class="mb-4">
                            <div class="text-sm text-gray-600 mb-2">
                                <i class="fas fa-filter"></i> Quick Filters:
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-graduation-cap"></i> Academic
                                </button>
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-university"></i> Government
                                </button>
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-newspaper"></i> News
                                </button>
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-flag"></i> Thai Only
                                </button>
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-globe"></i> Global
                                </button>
                                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                    <i class="fas fa-chart-line"></i> Data
                                </button>
                                <!-- New: Meeting Knowledge Filter -->
                                <button class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm hover:bg-purple-200" onclick="searchMeetingKnowledge()">
                                    <i class="fas fa-brain"></i> Meeting Knowledge
                                    <span class="ai-badge">AI</span>
                                </button>
                            </div>
                        </div>

                        <!-- Search Response Area -->
                        <div id="searchResponse" class="hidden">
                            <div class="border-l-4 border-gray-500 rounded-lg p-4 mb-4 bg-gray-50">
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center text-white font-bold">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-gray-900 leading-relaxed" id="responseText"></div>
                                        <div class="mt-4 flex flex-wrap gap-2" id="sourceCitations"></div>
                                        <div class="mt-4 pt-4 border-t">
                                            <div class="flex space-x-2">
                                                <button onclick="exportToDoc()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                                    <i class="fab fa-google-drive"></i> Export to Google Docs
                                                </button>
                                                <button onclick="exportToWord()" class="px-4 py-2 bg-blue-800 text-white rounded-lg hover:bg-blue-900 text-sm">
                                                    <i class="fab fa-microsoft"></i> Export to Word
                                                </button>
                                                <button onclick="shareWithTeam()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">
                                                    <i class="fas fa-share-alt"></i> Share with Team
                                                </button>
                                                <!-- New: Create Meeting Follow-up -->
                                                <button onclick="createMeetingFollowup()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">
                                                    <i class="fas fa-calendar-plus"></i> Schedule Follow-up
                                                    <span class="ai-badge">Auto</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Follow-up Questions -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="text-sm text-gray-600 mb-2">
                                    <i class="fas fa-lightbulb"></i> Follow-up Questions:
                                </div>
                                <div class="space-y-2" id="followUpQuestions"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Suggested Research -->
                    <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-lightbulb text-gray-600"></i> Suggested Research for Government Officials:
                        </h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 cursor-pointer card-hover" onclick="suggestedSearch('การขอจดทะเบียนธุรกิจใหม่')">
                                <div class="font-medium text-gray-900">การขอจดทะเบียนธุรกิจใหม่</div>
                                <div class="text-sm text-gray-600 mt-1">ขั้นตอนและเอกสารที่จำเป็น</div>
                            </div>
                            <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 cursor-pointer card-hover" onclick="suggestedSearch('กฎหมายแรงงาน 2567')">
                                <div class="font-medium text-gray-900">กฎหมายแรงงาน 2567</div>
                                <div class="text-sm text-gray-600 mt-1">การปรับปรุงล่าสุด</div>
                            </div>
                            <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 cursor-pointer card-hover" onclick="suggestedSearch('ระเบียบการเบิกค่าใช้จ่าย')">
                                <div class="font-medium text-gray-900">ระเบียบการเบิกค่าใช้จ่าย</div>
                                <div class="text-sm text-gray-600 mt-1">หลักเกณฑ์และแนวปฏิบัติ</div>
                            </div>
                            <div class="p-4 border border-gray-200 rounded-lg hover:border-gray-400 cursor-pointer card-hover" onclick="suggestedSearch('นโยบายรัฐบาลดิจิทัล')">
                                <div class="font-medium text-gray-900">นโยบายรัฐบาลดิจิทัล</div>
                                <div class="text-sm text-gray-600 mt-1">แผนพัฒนาประเทศ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Research -->
                    <div class="bg-white rounded-xl shadow-sm border p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-history text-gray-600"></i> Recent Research (3):
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-file-alt text-gray-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium text-gray-900">รายงานงบประมาณ Q1</div>
                                        <div class="text-sm text-gray-500">2 ชั่วโมงที่แล้ว • 25 credits</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex -space-x-2">
                                        <div class="w-6 h-6 bg-gray-500 rounded-full border-2 border-white flex items-center justify-center text-xs text-white">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="w-6 h-6 bg-gray-400 rounded-full border-2 border-white flex items-center justify-center text-xs text-white">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="w-6 h-6 bg-gray-300 rounded-full border-2 border-white flex items-center justify-center text-xs text-white">+3</div>
                                    </div>
                                    <button class="text-gray-400 hover:text-gray-600">
                                        <i class="fas fa-ellipsis-h"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Meeting Analysis Section (Enhanced with Nexus Features) -->
                <div id="meetingAnalysis" class="hidden">
                    <!-- Meeting Intelligence Header -->
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900 mb-2">
                            <i class="fas fa-microphone text-indigo-600"></i> Meeting Intelligence System
                            <span class="ai-badge">Powered by AI</span>
                        </h1>
                        <p class="text-gray-600">บันทึก ถอดเสียง สรุป และจัดการการประชุมอัตโนมัติด้วย AI</p>
                    </div>

                    <!-- Live Recording Section (New Nexus Feature) -->
                    <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-record-vinyl text-red-500 mr-2"></i> Live Meeting Recording
                                <span class="ai-badge">Real-time</span>
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="startLiveRecording()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">
                                    <i class="fas fa-circle text-white animate-pulse mr-2"></i> Start Recording
                                </button>
                                <button class="px-4 py-2 btn-outline rounded-lg">
                                    <i class="fas fa-video mr-2"></i> Join Zoom/Meet
                                </button>
                            </div>
                        </div>
                        
                        <div id="liveRecordingStatus" class="hidden">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                                    <div class="flex-1">
                                        <div class="font-medium text-red-900">Recording in Progress</div>
                                        <div class="text-sm text-red-600">Duration: <span id="recordingTimer">00:00</span> • Auto-transcribing in real-time</div>
                                    </div>
                                    <button onclick="stopLiveRecording()" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                        <i class="fas fa-stop mr-1"></i> Stop
                                    </button>
                                </div>
                                
                                <!-- Real-time Transcription Preview -->
                                <div class="mt-4 p-3 bg-white rounded border">
                                    <div class="text-sm text-gray-600 mb-2">Real-time Transcription:</div>
                                    <div id="liveTranscript" class="text-gray-800 min-h-16 max-h-32 overflow-y-auto">
                                        <div class="text-gray-400 italic">Listening for speech...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Section -->
                    <div class="bg-white rounded-xl shadow-sm border p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-upload text-gray-600 mr-2"></i> Upload Meeting Recording
                        </h3>
                        
                        <!-- Multi-language Support Notice -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-globe text-blue-600"></i>
                                <span class="text-sm text-blue-800">รองรับ: ไทย, English, 中文, 日本語</span>
                            </div>
                        </div>
                        
                        <!-- Drag & Drop Area -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="text-lg font-medium text-gray-700 mb-2">ลากไฟล์เสียงมาวางที่นี่</p>
                                <p class="text-sm text-gray-500 mb-4">รองรับ MP3, WAV, M4A, MP4 (สูงสุด 2GB)</p>
                                <button onclick="simulateMeetingUpload()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    <i class="fas fa-folder-open mr-2"></i> เลือกไฟล์
                                </button>
                            </div>
                        </div>

                        <!-- Processing Options (Enhanced) -->
                       <div class="mt-6 grid md:grid-cols-3 gap-4">
                        <div class="border rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 mb-2">Language Detection</h4>
                            <select class="w-full border border-gray-300 rounded px-3 py-2">
                                <option>Auto-detect</option>
                                <option>Thai</option>
                                <option>English</option>
                                <option>Mixed (Thai/English)</option>
                                <option>Chinese</option>
                                <option>Japanese</option>
                            </select>
                        </div>
                        <div class="border rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 mb-2">Meeting Template</h4>
                            <select class="w-full border border-gray-300 rounded px-3 py-2">
                                <option>Government Meeting</option>
                                <option>Team Standup</option>
                                <option>Project Review</option>
                                <option>Budget Discussion</option>
                                <option>Client Meeting</option>
                                <option>Custom Template</option>
                            </select>
                        </div>
                        <div class="border rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 mb-2">AI Features</h4>
                            <div class="space-y-2 text-sm">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2"> Auto Action Items
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2"> Smart Summary
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2"> Email Follow-up
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing Status -->
                <div id="processingStatus" class="bg-white rounded-xl shadow-sm border p-6 mb-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-cogs text-gray-600 mr-2"></i> AI Processing Status
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                                <i class="fas fa-check text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">Audio Upload Complete</div>
                                <div class="text-sm text-gray-500">meeting_20241202.mp3 (45MB, 62 minutes)</div>
                            </div>
                            <div class="text-sm text-green-600">✓ Done</div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center text-white meeting-status">
                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">AI Transcription & Analysis</div>
                                <div class="text-sm text-gray-500">Language: Thai/English • Template: Government Meeting</div>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="bg-gray-600 h-2 rounded-full transition-all duration-500" style="width: 65%"></div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600">65%</div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-500">
                                <i class="fas fa-brain text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-500">Smart Summary Generation</div>
                                <div class="text-sm text-gray-400">Action items, decisions, next steps...</div>
                            </div>
                            <div class="text-sm text-gray-400">Pending</div>
                        </div>

                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-gray-500">
                                <i class="fas fa-envelope text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-medium text-gray-500">Auto Follow-up Setup</div>
                                <div class="text-sm text-gray-400">Calendar invites, email templates...</div>
                            </div>
                            <div class="text-sm text-gray-400">Pending</div>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-clock mr-1"></i> Estimated time remaining: 2-3 minutes
                        </div>
                        <div class="text-sm text-purple-600">
                            <i class="fas fa-coins mr-1"></i> Cost: ~45 credits (AI Enhanced)
                        </div>
                    </div>
                </div>

                <!-- Meeting Chat Interface (New Nexus Feature) -->
                <div id="meetingChatInterface" class="bg-white rounded-xl shadow-sm border p-6 mb-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-comments text-purple-600 mr-2"></i> Ask Meeting AI
                        <span class="ai-badge">Conversational</span>
                    </h3>

                    <div class="border rounded-lg p-4 mb-4 max-h-64 overflow-y-auto" id="chatHistory">
                        <div class="text-center text-gray-500 text-sm">
                            <i class="fas fa-brain text-2xl mb-2"></i>
                            <div>AI พร้อมตอบคำถามเกี่ยวกับการประชุมทั้งหมดของคุณ</div>
                            <div class="text-xs mt-1">ลองถาม: "การตัดสินใจสำคัญในการประชุมเมื่อวานคืออะไร?"</div>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <input type="text" 
                               id="meetingChatInput"
                               placeholder="ถามคำถามเกี่ยวกับการประชุม เช่น 'ใครเป็นคนตัดสินใจเรื่องงบประมาณ?'"
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none search-input"
                               onkeydown="handleChatKeydown(event)">
                        <button onclick="sendMeetingChat()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                    <!-- Quick Questions -->
                    <div class="mt-4">
                        <div class="text-sm text-gray-600 mb-2">Quick Questions:</div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="quickMeetingQuestion('action-items')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                Action Items วันนี้
                            </button>
                            <button onclick="quickMeetingQuestion('decisions')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                การตัดสินใจสำคัญ
                            </button>
                            <button onclick="quickMeetingQuestion('next-meeting')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                ประชุมครั้งถัดไป
                            </button>
                            <button onclick="quickMeetingQuestion('budget')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
                                เรื่องงบประมาณ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Meeting Summary (Nexus Style) -->
                <div id="meetingSummary" class="bg-white rounded-xl shadow-sm border p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-brain text-purple-600 mr-2"></i> AI Meeting Summary
                            <span class="ai-badge">Enhanced</span>
                        </h3>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 btn-outline rounded text-sm hover:bg-gray-50">
                                <i class="fas fa-edit mr-1"></i> Edit Template
                            </button>
                            <button class="px-3 py-1 btn-outline rounded text-sm hover:bg-gray-50">
                                <i class="fas fa-eye mr-1"></i> Review
                            </button>
                            <button onclick="approveMeetingSummary()" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                <i class="fas fa-check mr-1"></i> Approve & Send
                            </button>
                        </div>
                    </div>

                    <!-- AI Insights Panel (New) -->
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-purple-900 mb-2 flex items-center">
                            <i class="fas fa-lightbulb text-purple-600 mr-2"></i> AI Insights
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4 text-sm">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600">7</div>
                                <div class="text-purple-700">Action Items</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600">3</div>
                                <div class="text-purple-700">Decisions Made</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600">85%</div>
                                <div class="text-purple-700">Confidence Score</div>
                            </div>
                        </div>
                    </div>

                    <!-- Auto-Generated Action Items (Enhanced) -->
                    <div class="border-l-4 border-green-500 pl-4 mb-6">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                            ✅ Action Items 
                            <span class="ai-badge ml-2">Auto-Generated</span>
                        </h4>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1">
                                <div class="flex-1">
                                    <div class="font-medium text-gray-900">น้องเอ: ปรับปรุง API documentation</div>
                                    <div class="text-sm text-gray-600">Deadline: 5 ธ.ค. 2567 • Priority: High</div>
                                    <div class="text-xs text-purple-600 mt-1">
                                        <i class="fas fa-robot mr-1"></i> AI จะส่งอีเมลเตือนอัตโนมัติ 1 วันก่อนครบกำหนด
                                    </div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="p-1 text-gray-400 hover:text-blue-600" title="Send Email">
                                        <i class="fas fa-envelope text-xs"></i>
                                    </button>
                                    <button class="p-1 text-gray-400 hover:text-green-600" title="Add to Calendar">
                                        <i class="fas fa-calendar-plus text-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" class="mt-1">
                                <div class="flex-1">
                                    <div class="font-medium text-gray-900">พี่บี: จัดทำรายงานงบประมาณ Q1</div>
                                    <div class="text-sm text-gray-600">Deadline: 8 ธ.ค. 2567 • Priority: Medium</div>
                                    <div class="text-xs text-purple-600 mt-1">
                                        <i class="fas fa-robot mr-1"></i> AI เตรียมเทมเพลตรายงานไว้ให้แล้ว
                                    </div>
                                </div>
                                <div class="flex space-x-1">
                                    <button class="p-1 text-gray-400 hover:text-blue-600" title="Send Email">
                                        <i class="fas fa-envelope text-xs"></i>
                                    </button>
                                    <button class="p-1 text-gray-400 hover:text-green-600" title="Add to Calendar">
                                        <i class="fas fa-calendar-plus text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Follow-up Suggestions (New Nexus Feature) -->
                    <div class="border-l-4 border-blue-500 pl-4 mb-6">
                        <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                            🤖 AI Follow-up Suggestions
                            <span class="ai-badge ml-2">Smart</span>
                        </h4>
                        <div class="space-y-3">
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <div class="font-medium text-blue-900">Recommended Next Meeting</div>
                                <div class="text-sm text-blue-700 mt-1">
                                    📅 วันศุกร์ 6 ธ.ค. 2567 เวลา 14:00 น. (Based on team availability)
                                </div>
                                <div class="text-sm text-blue-600 mt-1">
                                    หัวข้อ: "Review Progress & Budget Approval"
                                </div>
                                <button class="mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    <i class="fas fa-calendar-plus mr-1"></i> Schedule Meeting
                                </button>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <div class="font-medium text-blue-900">Email Template Ready</div>
                                <div class="text-sm text-blue-700 mt-1">
                                    AI เตรียมอีเมลสรุปการประชุมส่งให้ทีมแล้ว
                                </div>
                                <button class="mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    <i class="fas fa-paper-plane mr-1"></i> Send Email
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Content (Enhanced) -->
                    <div class="space-y-6">
                        <div class="border-l-4 border-gray-500 pl-4">
                            <h4 class="font-semibold text-gray-900 mb-2">📋 Meeting Overview</h4>
                            <div class="text-gray-700">
                                <p><strong>วันที่:</strong> 2 ธันวาคม 2567</p>
                                <p><strong>เวลา:</strong> 14:00 - 15:02 น. (62 นาที)</p>
                                <p><strong>ผู้เข้าร่วม:</strong> พี่โล่ (หัวหน้าทีม), น้องเอ (นักพัฒนา), พี่บี (วิเคราะห์)</p>
                                <p><strong>หัวข้อหลัก:</strong> ความคืบหน้าโครงการ FlowWork และแผนงานข้างหน้า</p>
                                <p><strong>AI Confidence:</strong> <span class="text-green-600">85% (High Quality)</span></p>
                            </div>
                        </div>

                        <!-- Export & Share Options (Enhanced) -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-3">📤 Export & Automation</h4>
                            <div class="grid md:grid-cols-2 gap-3">
                                <button onclick="exportToDoc()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                    <i class="fab fa-google-drive mr-2"></i> Google Docs
                                </button>
                                <button onclick="exportToWord()" class="px-4 py-2 bg-blue-800 text-white rounded-lg hover:bg-blue-900 text-sm">
                                    <i class="fab fa-microsoft mr-2"></i> Word
                                </button>
                                <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">
                                    <i class="fas fa-file-pdf mr-2"></i> PDF Report
                                </button>
                                <button onclick="shareWithTeam()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm">
                                    <i class="fas fa-share-alt mr-2"></i> Share with Team
                                </button>
                                <!-- New Nexus Features -->
                                <button onclick="createFollowupEmail()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">
                                    <i class="fas fa-envelope-open-text mr-2"></i> Auto Email
                                    <span class="ai-badge ml-1">AI</span>
                                </button>
                                <button onclick="scheduleNextMeeting()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm">
                                    <i class="fas fa-calendar-check mr-2"></i> Schedule Next
                                    <span class="ai-badge ml-1">Smart</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Right Panel (Enhanced with Nexus Features) -->
    <aside class="w-80 bg-white border-l border-gray-100 overflow-y-auto">
        <div class="p-4 space-y-4">
            
            <!-- Quick Actions (Outline Style) -->
            <div class="mb-6">
                <h3 class="text-sm font-medium text-gray-700 mb-3 uppercase tracking-wide">Quick Actions</h3>
                <div class="space-y-2">
                    <button class="w-full px-3 py-2 text-left text-sm text-gray-700 btn-outline rounded-lg transition-colors">
                        <i class="fas fa-file-plus w-4 mr-2 text-gray-400"></i> New Document
                    </button>
                    <button class="w-full px-3 py-2 text-left text-sm text-gray-700 btn-outline rounded-lg transition-colors">
                        <i class="fas fa-user-plus w-4 mr-2 text-gray-400"></i> Invite Team
                    </button>
                    <button class="w-full px-3 py-2 text-left text-sm text-gray-700 btn-outline rounded-lg transition-colors" onclick="startLiveRecording()">
                        <i class="fas fa-record-vinyl w-4 mr-2 text-red-400"></i> Start Recording
                        <span class="ai-badge ml-2">Live</span>
                    </button>
                    <!-- New Nexus Quick Actions -->
                    <button class="w-full px-3 py-2 text-left text-sm text-gray-700 btn-outline rounded-lg transition-colors" onclick="showMeetingChat()">
                        <i class="fas fa-comments w-4 mr-2 text-purple-400"></i> Ask Meeting AI
                        <span class="ai-badge ml-2">Chat</span>
                    </button>
                </div>
            </div>

            <!-- Live Meeting Status (New) -->
            <div id="liveMeetingPanel" class="mb-6 hidden">
                <h3 class="text-sm font-medium text-gray-700 mb-3 uppercase tracking-wide">Live Meeting</h3>
                <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-medium text-red-900">Recording Active</span>
                    </div>
                    <div class="text-xs text-red-600 space-y-1">
                        <div>Duration: <span id="liveDuration">00:00</span></div>
                        <div>Participants: 3 detected</div>
                        <div>Language: Thai/English</div>
                    </div>
                    <button onclick="stopLiveRecording()" class="w-full mt-2 px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">
                        <i class="fas fa-stop mr-1"></i> Stop Recording
                    </button>
                </div>
            </div>

            <!-- AI Meeting Insights (New) -->
            <div class="mb-6">
                <h3 class="text-sm font-medium text-gray-700 mb-3 uppercase tracking-wide">AI Insights</h3>
                <div class="space-y-3">
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                        <div class="text-xs text-purple-600 mb-1">Today's Meetings</div>
                        <div class="text-lg font-semibold text-purple-900">3</div>
                        <div class="text-xs text-purple-600">12 action items pending</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div class="text-xs text-blue-600 mb-1">This Week's Performance</div>
                        <div class="text-lg font-semibold text-blue-900">92%</div>
                        <div class="text-xs text-blue-600">Meeting efficiency score</div>
                    </div>
                </div>
            </div>

            <!-- Team Status -->
            <div class="mb-6">
                <h3 class="text-sm font-medium text-gray-700 mb-3 uppercase tracking-wide">Team Status</h3>
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center relative">
                            <i class="fas fa-user text-white text-xs"></i>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-900">โล่</div>
                            <div class="text-xs text-gray-500">Team Leader</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center relative">
                            <i class="fas fa-user text-white text-xs"></i>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-900">เอ</div>
                            <div class="text-xs text-gray-500">Developer</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center relative">
                            <i class="fas fa-user text-white text-xs"></i>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-yellow-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-900">บี</div>
                            <div class="text-xs text-gray-500">In Meeting</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div>
                <h3 class="text-sm font-medium text-gray-700 mb-3 uppercase tracking-wide">Recent Activity</h3>
                <div class="space-y-3 text-xs">
                    <div class="flex space-x-2">
                        <span class="text-gray-400">15:30</span>
                        <div class="text-gray-600">
                            <span class="font-medium">โล่</span> shared <span class="text-purple-600">"Budget Report"</span>
                            <span class="ai-badge ml-1">AI</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <span class="text-gray-400">14:45</span>
                        <div class="text-gray-600">
                            <span class="font-medium">เอ</span> completed research
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <span class="text-gray-400">13:20</span>
                        <div class="text-gray-600">
                            AI scheduled follow-up meeting <span class="text-gray-400">(Auto)</span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <span class="text-gray-400">12:10</span>
                        <div class="text-gray-600">
                            Meeting recorded <span class="text-gray-400">(45 min)</span>
                            <span class="ai-badge ml-1">Complete</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </aside>
</div>

<!-- User Type Selection Modal -->
<div id="userTypeModal" class="fixed inset-0 bg-black bg-opacity-30 z-50 hidden">
    <div class="flex items-center justify-center h-full p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Select User Type</h3>
            <div class="space-y-3">
                <button onclick="setUserType('government')" class="w-full p-4 border-2 border-gray-200 bg-gray-50 rounded-xl text-left">
                    <div class="font-medium text-gray-900 flex items-center">
                        <i class="fas fa-university text-gray-600 mr-2"></i> Government Official
                    </div>
                    <div class="text-sm text-gray-600">For official research and legal documentation</div>
                </button>
                <button onclick="setUserType('student')" class="w-full p-4 border border-gray-200 rounded-xl text-left hover:border-gray-300">
                    <div class="font-medium text-gray-900 flex items-center">
                        <i class="fas fa-graduation-cap text-gray-600 mr-2"></i> Student
                    </div>
                    <div class="text-sm text-gray-600">For academic research and assignments</div>
                </button>
                <button onclick="setUserType('business')" class="w-full p-4 border border-gray-200 rounded-xl text-left hover:border-gray-300">
                    <div class="font-medium text-gray-900 flex items-center">
                        <i class="fas fa-building text-gray-600 mr-2"></i> Business
                    </div>
                    <div class="text-sm text-gray-600">For market analysis and business intelligence</div>
                </button>
            </div>
            <button onclick="closeUserTypeModal()" class="w-full mt-4 px-4 py-2 text-gray-600 hover:bg-gray-50 rounded-xl">
                Cancel
            </button>
        </div>
    </div>
</div>

<script>
    // Enhanced AI responses with meeting knowledge
    const aiResponses = {
        'การขอจดทะเบียนธุรกิจใหม่': {
            text: `การจดทะเบียนธุรกิจใหม่ในประเทศไทยมีขั้นตอนหลักดังนี้:

**1. การเตรียมเอกสาร**
- หนังสือรับรองบริษัท (ถ้าเป็นนิติบุคคล)
- บัตรประชาชนผู้มีอำนาจลงนาม
- หนังสือมอบอำนาจ (ถ้ามี)

**2. การยื่นคำขอ**
- ยื่นคำขอที่กรมพัฒนาธุรกิจการค้า
- ชำระค่าธรรมเนียม 500-1,000 บาท
- ระยะเวลาดำเนินการ 1-3 วันทำการ

**3. การรับใบทะเบียน**
- รับใบทะเบียนการค้า
- ต้องต่ออายุทุก 5 ปี

💡 **Meeting Insight:** ในการประชุมเมื่อวานนี้ ทีมได้หารือเรื่องการจดทะเบียนสำหรับโครงการใหม่ พี่บีแนะนำให้ปรึกษาที่ปรึกษากฎหมายก่อน`,
            sources: [
                { title: "กรมพัฒนาธุรกิจการค้า", url: "dbd.go.th", confidence: "high" },
                { title: "Meeting Minutes 1 Dec 2567", url: "internal", confidence: "meeting" }
            ],
            followUp: [
                "ค่าธรรมเนียมการจดทะเบียนแต่ละประเภทธุรกิจ",
                "เอกสารเพิ่มเติมสำหรับธุรกิจต่างชาติ"
            ]
        }
    };

    let currentUserType = 'government';
    let isRecording = false;
    let recordingTimer = 0;
    let recordingInterval;

    // Enhanced functions with Nexus features
    function showResearch() {
        document.getElementById('researchSection').classList.remove('hidden');
        document.getElementById('meetingAnalysis').classList.add('hidden');
        document.getElementById('meetingChatInterface').classList.add('hidden');
        updateNavActive(0);
    }

    function showMeetingAnalysis() {
        document.getElementById('researchSection').classList.add('hidden');
        document.getElementById('meetingAnalysis').classList.remove('hidden');
        document.getElementById('meetingChatInterface').classList.add('hidden');
        updateNavActive(3);
    }

    function showMeetingChat() {
        document.getElementById('researchSection').classList.add('hidden');
        document.getElementById('meetingAnalysis').classList.add('hidden');
        document.getElementById('meetingChatInterface').classList.remove('hidden');
        updateNavActive(3);
    }

    function showMeetingKnowledge() {
        showResearch();
        document.getElementById('mainSearch').value = '';
        document.getElementById('mainSearch').placeholder = 'ค้นหาจากประวัติการประชุม เช่น "การตัดสินใจเรื่องงบประมาณในการประชุมเมื่อวาน"';
        document.getElementById('mainSearch').focus();
    }

    // New Nexus Features
    function startLiveRecording() {
        if (isRecording) return;
        
        isRecording = true;
        recordingTimer = 0;
        
        // Show live recording status
        document.getElementById('liveRecordingStatus').classList.remove('hidden');
        document.getElementById('liveMeetingPanel').classList.remove('hidden');
        
        // Start timer
        recordingInterval = setInterval(() => {
            recordingTimer++;
            const minutes = Math.floor(recordingTimer / 60);
            const seconds = recordingTimer % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('recordingTimer').textContent = timeString;
            document.getElementById('liveDuration').textContent = timeString;
            
            // Simulate live transcription
            if (recordingTimer % 10 === 0) {
                simulateLiveTranscription();
            }
        }, 1000);
        
        showNotification('Live recording started! AI is transcribing in real-time.', 'success');
    }

    function stopLiveRecording() {
        if (!isRecording) return;
        
        isRecording = false;
        clearInterval(recordingInterval);
        
        document.getElementById('liveRecordingStatus').classList.add('hidden');
        document.getElementById('liveMeetingPanel').classList.add('hidden');
        
        // Show processing
        showMeetingAnalysis();
        document.getElementById('processingStatus').classList.remove('hidden');
        
        setTimeout(() => {
            document.getElementById('meetingSummary').classList.remove('hidden');
            document.getElementById('meetingSummary').scrollIntoView({ behavior: 'smooth' });
        }, 3000);
        
        showNotification('Recording stopped. AI is processing the meeting summary.', 'info');
    }

    function simulateLiveTranscription() {
        const transcriptions = [
            "ครับ เรามาเริ่มการประชุมกันครับ วันนี้เราจะพูดถึงความคืบหน้าของโครงการ",
            "ตอนนี้ผลงานด้านเทคนิคเป็นอย่างไร มีปัญหาอะไรที่ต้องแก้ไขมั้ยครับ",
            "สำหรับเรื่องงบประมาณ เราควรจะปรับแผนการใช้จ่ายใหม่",
            "ผมคิดว่าเราควรจะกำหนดประชุมครั้งถัดไปในสัปดาห์หน้า"
        ];
        
        const randomTranscription = transcriptions[Math.floor(Math.random() * transcriptions.length)];
        const transcriptDiv = document.getElementById('liveTranscript');
        
        if (transcriptDiv.querySelector('.text-gray-400')) {
            transcriptDiv.innerHTML = '';
        }
        
        const newLine = document.createElement('div');
        newLine.className = 'text-gray-800 mb-2';
        newLine.innerHTML = `<span class="font-medium text-blue-600">[${new Date().toLocaleTimeString()}]</span> ${randomTranscription}`;
        transcriptDiv.appendChild(newLine);
        
        // Scroll to bottom
        transcriptDiv.scrollTop = transcriptDiv.scrollHeight;
    }

    function simulateMeetingUpload() {
        showMeetingAnalysis();
        document.getElementById('processingStatus').classList.remove('hidden');
        
        // Enhanced processing simulation
        let progress = 0;
        const progressBar = document.querySelector('#processingStatus .bg-gray-600');
        
        const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 100) progress = 100;
            
            progressBar.style.width = progress + '%';
            progressBar.parentElement.nextElementSibling.textContent = Math.round(progress) + '%';
            
            if (progress >= 100) {
                clearInterval(progressInterval);
                setTimeout(() => {
                    document.getElementById('meetingSummary').classList.remove('hidden');
                    document.getElementById('meetingSummary').scrollIntoView({ behavior: 'smooth' });
                }, 1000);
            }
        }, 200);
    }

    // Meeting Chat Functions
    function sendMeetingChat() {
        const input = document.getElementById('meetingChatInput');
        const question = input.value.trim();
        if (!question) return;
        
        addChatMessage('user', question);
        input.value = '';
        
        // Simulate AI response
        setTimeout(() => {
            const responses = {
                'action': 'จากการประชุมล่าสุด มี 3 action items หลัก: 1) น้องเอปรับปรุง API documentation 2) พี่บีจัดทำรายงานงบประมาณ 3) พี่โล่ติดต่อพาร์ทเนอร์ใหม่',
                'งบประมาณ': 'ในการประชุมเมื่อวาน พี่บีได้นำเสนอว่างบประมาณ Q1 ต้องการการปรับแผน เนื่องจากค่าใช้จ่าย AI API สูงกว่าที่คาดการณ์ไว้',
                'การตัดสินใจ': 'การตัดสินใจสำคัญจากการประชุม: 1) อนุมัติงบเพิ่มเติม 50,000 บาท 2) เลื่อนการเปิดตัว Beta ไป 15 ธ.ค. 3) ให้ความสำคัญกับการทดสอบ',
                'ประชุม': 'การประชุมครั้งถัดไปกำหนดไว้วันศุกร์ที่ 6 ธ.ค. 2567 เวลา 14:00 น. หัวข้อ: Review ผลงานและเตรียมการเปิดตัว Beta'
            };
            
            let response = "ขออภัยครับ ไม่พบข้อมูลที่เกี่ยวข้องในประวัติการประชุม";
            
            for (let key in responses) {
                if (question.includes(key)) {
                    response = responses[key];
                    break;
                }
            }
            
            addChatMessage('ai', response);
        }, 1000);
    }

    function quickMeetingQuestion(type) {
        const questions = {
            'action-items': 'Action Items ทั้งหมดจากการประชุมล่าสุดมีอะไรบ้าง',
            'decisions': 'การตัดสินใจสำคัญในการประชุมเมื่อวานคืออะไร',
            'next-meeting': 'การประชุมครั้งถัดไปกำหนดเมื่อไหร่',
            'budget': 'มีการหารือเรื่องงบประมาณอะไรบ้างในการประชุมที่ผ่านมา'
        };
        
        document.getElementById('meetingChatInput').value = questions[type];
        sendMeetingChat();
    }

    function addChatMessage(sender, message) {
        const chatHistory = document.getElementById('chatHistory');
        
        // Clear initial message if exists
        if (chatHistory.querySelector('.text-center')) {
            chatHistory.innerHTML = '';
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `mb-3 ${sender === 'user' ? 'text-right' : 'text-left'}`;
        
        if (sender === 'user') {
            messageDiv.innerHTML = `
                <div class="inline-block bg-gray-600 text-white px-3 py-2 rounded-lg max-w-xs text-sm">
                    ${message}
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="inline-block bg-purple-50 border border-purple-200 px-3 py-2 rounded-lg max-w-sm text-sm">
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-brain text-purple-600 mt-1"></i>
                        <div>${message}</div>
                    </div>
                </div>
            `;
        }
        
        chatHistory.appendChild(messageDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function handleChatKeydown(event) {
        if (event.key === 'Enter') {
            sendMeetingChat();
        }
    }

    function searchMeetingKnowledge() {
        document.getElementById('mainSearch').focus();
        showNotification('Searching meeting knowledge base...', 'info');
    }

    // Enhanced export functions
    function createMeetingFollowup() {
        showNotification('AI is creating meeting follow-up tasks and calendar invites...', 'info');
        setTimeout(() => {
            showNotification('Follow-up email sent and next meeting scheduled!', 'success');
        }, 2000);
    }

    function createFollowupEmail() {
        showNotification('AI-generated follow-up email sent to team members!', 'success');
    }

    function scheduleNextMeeting() {
        showNotification('Smart meeting scheduled based on team availability!', 'success');
    }

    function approveMeetingSummary() {
        showNotification('Meeting summary approved and distributed to team!', 'success');
    }

    // Utility functions
    function updateNavActive(index) {
        document.querySelectorAll('.nav-item-active').forEach(item => {
            item.classList.remove('nav-item-active');
        });
        
        const navItems = document.querySelectorAll('.sidebar-section .cursor-pointer');
        if (navItems[index]) {
            navItems[index].classList.add('nav-item-active');
        }
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `fixed top-20 right-6 px-4 py-3 rounded-xl shadow-lg z-50 transform transition-all duration-300 translate-x-full ${
            type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
            type === 'info' ? 'bg-blue-100 text-blue-800 border border-blue-200' :
            'bg-gray-100 text-gray-800 border border-gray-200'
        }`;
        notification.innerHTML = `
            <div class="flex items-center space-x-2">
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'info' ? 'fa-info-circle' : 'fa-bell'} text-sm"></i>
                <span class="text-sm font-medium">${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => notification.classList.remove('translate-x-full'), 100);
        setTimeout(() => {
            notification.classList.add('translate-x-full');
            setTimeout(() => document.body.removeChild(notification), 300);
        }, 3000);
    }

    // Keep existing functions
    function performSearch() {
        const searchText = document.getElementById('mainSearch').value.trim();
        if (!searchText) return;
        showSearchResponse(searchText);
    }

    function suggestedSearch(query) {
        document.getElementById('mainSearch').value = query;
        showSearchResponse(query);
    }

    function showSearchResponse(query) {
        const responseDiv = document.getElementById('searchResponse');
        const responseText = document.getElementById('responseText');
        const sourceCitations = document.getElementById('sourceCitations');
        const followUpQuestions = document.getElementById('followUpQuestions');

        responseDiv.classList.remove('hidden');
        responseText.innerHTML = '<div class="flex items-center space-x-2"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"></div><span class="text-gray-600">Searching and analyzing...</span></div>';

        setTimeout(() => {
            const response = aiResponses[query] || {
                text: `ไม่พบข้อมูลจำลองสำหรับ "${query}" ในระบบ FlowWork ที่จะให้การค้นหาที่ครอบคลุมจากแหล่งข้อมูลราชการไทยและประวัติการประชุมของทีม`,
                sources: [{ title: "FlowWork Demo", url: "demo.flow.in.th", confidence: "demo" }],
                followUp: ["การขอจดทะเบียนธุรกิจใหม่", "กฎหมายแรงงาน 2567"]
            };

            typeWriter(responseText, response.text, 30);

            sourceCitations.innerHTML = response.sources.map(source => 
                `<div class="inline-flex items-center space-x-1 px-2 py-1 bg-gray-100 rounded-lg text-xs">
                    <div class="w-2 h-2 rounded-full ${getConfidenceColor(source.confidence)}"></div>
                    <span>${source.title}</span>
                    ${source.confidence === 'meeting' ? '<span class="ai-badge ml-1">Meeting</span>' : ''}
                </div>`
            ).join('');

            followUpQuestions.innerHTML = response.followUp.map(question =>
                `<button onclick="suggestedSearch('${question}')" class="block w-full text-left px-3 py-2 bg-white border border-gray-200 rounded hover:border-gray-400 hover:bg-gray-50 text-sm">
                    ${question}
                </button>`
            ).join('');

            responseDiv.scrollIntoView({ behavior: 'smooth' });
        }, 1500);
    }

    function typeWriter(element, text, speed) {
        element.innerHTML = '';
        let i = 0;
        function type() {
            if (i < text.length) {
                element.innerHTML += text.charAt(i);
                i++;
                setTimeout(type, speed);
            }
        }
        type();
    }

    function getConfidenceColor(confidence) {
        switch(confidence) {
            case 'high': return 'bg-green-500';
            case 'medium': return 'bg-yellow-500';
            case 'low': return 'bg-red-500';
            case 'meeting': return 'bg-purple-500';
            default: return 'bg-gray-500';
        }
    }

    function handleSearchKeydown(event) {
        if (event.ctrlKey && event.key === 'Enter') {
            performSearch();
        }
    }

    function exportToDoc() {
        showNotification('Exporting to Google Docs with AI enhancements...', 'success');
    }

    function exportToWord() {
        showNotification('Exporting to Microsoft Word...', 'success');
    }

    function shareWithTeam() {
        showNotification('Sharing with team...', 'info');
    }

    function changeUserType() {
        document.getElementById('userTypeModal').classList.remove('hidden');
    }

    function closeUserTypeModal() {
        document.getElementById('userTypeModal').classList.add('hidden');
    }

    function setUserType(type) {
        currentUserType = type;
        closeUserTypeModal();
        showNotification(`Switched to ${type} mode with AI optimization`, 'success');
    }

    function toggleTeamDropdown() {
        showNotification('Team selector would open here', 'info');
    }

    // Initialize enhanced dashboard
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('mainSearch').focus();
        console.log('🚀 FlowWork Enhanced Dashboard with Nexus AI features initialized!');
        
        setTimeout(() => {
            showNotification('FlowWork Enhanced with AI Meeting Intelligence is ready!', 'info');
        }, 1000);
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('mainSearch').focus();
        }
        if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
            e.preventDefault();
            startLiveRecording();
        }
        if (e.key === 'Escape') {
            closeUserTypeModal();
            if (isRecording) stopLiveRecording();
        }
    });
</script>

</body>
</html>